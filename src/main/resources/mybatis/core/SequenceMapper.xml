<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kxai.qms.core.dao.SequenceDao">

    <!-- 根据序列名获取值 -->
    <select id="findBySequenceName" parameterType="string" resultType="Sequence">
        SELECT
            sequence_name AS sequenceName,
            next_value    AS nextValue
        FROM sequence
        WHERE sequence_name = #{sequenceName}
    </select>

    <!-- 查找最后插入的ID值 -->
    <select id="findLastInsertId" resultType="int">
        SELECT
            last_insert_id()
    </select>

    <!-- 保存 -->
    <insert id="save" parameterType="string">
        INSERT INTO sequence VALUES (#{sequenceName}, 1)
        ON DUPLICATE KEY UPDATE next_value = last_insert_id(`next_value` + 1)
    </insert>

</mapper>